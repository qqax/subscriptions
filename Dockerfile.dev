# --- Development stage with hot reload using Air ---
FROM golang:1.25-alpine

# Set working directory
WORKDIR /app

# Install dependencies required for air and Go
RUN apk add --no-cache git curl

# Install air (binary)
RUN curl -fL https://raw.githubusercontent.com/cosmtrek/air/master/install.sh | sh && \
    mv ./bin/air /usr/local/bin/air

# Copy go.mod and go.sum and download modules
COPY go.mod go.sum ./
RUN go mod download

# Copy the source code
COPY . .

# Create a non-root user for safer dev execution
RUN addgroup -g 1000 -S devgroup && \
    adduser -u 1000 -S -G devgroup devuser
USER devuser

# Expose application port
EXPOSE 8080

# Run with Air (will look for .air.toml if exists)
CMD ["air"]
